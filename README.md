# Tactical Shogi Battle (変則ルール対戦型将棋)

## 1. ゲーム仕様詳細 (Specifications)

本アプリケーションは、将棋の盤面を利用した1対1のターン制タクティクスバトルです。
従来の将棋と異なり、「移動」と「攻撃」が分離されたアクションシステムを採用しています。

### 盤面・座標システム
* **フィールドサイズ**: 5列 × 8行（計40マス）
* **座標管理**: 2次元座標を1次元配列（インデックス 0〜39）にマッピングして管理。
    * 先手陣営：下側（インデックスが大きい側）
    * 後手陣営：上側（インデックスが小さい側）

### 勝利条件
* **敵軍の「King（大将）」のHPを0にする**
    * 他の駒が全滅していても、Kingさえ生き残っていればゲームは続行されます。

---

## 2. ユニット仕様 (Unit Specs)

各ユニット（駒）は固有のステータス（HP・攻撃力）に加え、**固有の移動範囲（Move Range）**と**攻撃射程（Attack Range）**を持ちます。

### ① King (大将) - 範囲攻撃の要
自軍のリーダーユニット。唯一「範囲攻撃」が可能で、戦況を一気に覆す力を持つ。
* **移動範囲**: 全方位 1マス
* **攻撃射程**: 周囲 1マス
* **特殊能力**: **Area of Effect (AOE)**
    * 指定した敵単体だけでなく、その**周囲にいる敵ユニットも巻き込んでダメージを与える**範囲攻撃を持つ。
    * プログラム上では攻撃対象の座標リストを取得し、ループ処理で一括ダメージ判定を行っている。

### ② General (将軍) - 近接特化
攻守のバランスに優れた前衛のエース。
* **移動範囲**: 前方・斜め前方を含む広範囲（金将・銀将に準拠）
* **攻撃射程**: 隣接 1マス
* **役割**: 高いHPと攻撃力を活かし、Kingを守る「壁」となりつつ、近づく敵を撃破する。

### ③ Knight (騎兵) - 高機動アタッカー
トリッキーな動きで敵陣の裏をかくユニット。
* **移動範囲**: 桂馬のように、前方の駒を飛び越えて移動可能（変則的なL字移動）。
* **攻撃射程**: 前方 1〜2マス（突き抜け攻撃）
* **役割**: 敵の防御網（Pawn）を飛び越えて、後衛のArcherやKingを直接狙う。

### ④ Archer (弓兵) - 遠距離支援
防御力は低いが、一方的に攻撃できる射程を持つ。
* **移動範囲**: 前後左右 1マス（足は遅い）
* **攻撃射程**: **2〜3マス先**の敵を攻撃可能（隣接されると攻撃できない）
* **役割**: 敵の攻撃範囲外（Out of Range）からHPを削るスナイパー。

### ⑤ Pawn (歩兵) - 前線維持
コストが低く、数を活かして戦線を構築する。
* **移動範囲**: 前方 1マス
* **攻撃射程**: 前方 1マス
* **役割**: 敵の進路を妨害するバリケード役。

---

## 3. アクションの仕様 (Action Logic)

プレイヤーは手番ごとに、選択した駒に対して以下のプロセスを実行します。

1. **Move Phase (移動)**
    * `piece.getMoveRange(currentPos)` を呼び出し、移動可能なマスをハイライト表示。
    * 敵の駒や障害物があるマスへの移動は制限される。
2. **Attack Phase (攻撃)**
    * 移動後、`piece.getAttackRange(newPos)` を呼び出し、射程内に敵がいるか判定。
    * 攻撃対象を選択すると、`piece.damage(attacker, target)` が実行され、攻撃力と防御力の差分がHPから引かれる。
    * **判定ロジック**:
        * 通常攻撃：単体対象。
        * King攻撃：`kingDamage`メソッドが発火し、対象配列全てに判定を行う。

---

## 4. 内部データの扱い
* **状態管理**: 盤面の各セルはString型で管理され、状態（State）を持つ。
    * `"my,Pawn1"` : 自軍のPawn1がいる
    * `"e,King"` : 敵軍のKingがいる
    * `"move,Board"` : 移動可能エリア（ハイライト）
    * `"attack,Board"` : 攻撃可能エリア（ハイライト）
* **判定処理**: 文字列の `split(",")` を用いて「所属（my/e/a/t）」と「職種（King/General...）」を解析し、フレンドリーファイア（味方撃ち）の防止や勝敗判定を行っている。
